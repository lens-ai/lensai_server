[supervisord]
nodaemon=true
user=root  ; Running as root, but recommended to change to a non-root user for security

[program:server]
command=uvicorn server:app --host 0.0.0.0 --port 8000
directory=/app               ; Specify the working directory for the server
autostart=true
autorestart=true
stderr_logfile=/var/log/server.err.log
stdout_logfile=/var/log/server.out.log
redirect_stderr=true          ; Redirect stderr to stdout for easier logging
startsecs=5                   ; Wait 5 seconds before considering the process started
startretries=3                ; Retry up to 3 times if the process fails to start

[program:worker_stats]
command=python3 worker_stats.py
directory=/app                ; Specify the working directory
autostart=true
autorestart=true
stderr_logfile=/var/log/worker_stats.err.log
stdout_logfile=/var/log/worker_stats.out.log
redirect_stderr=true          ; Redirect stderr to stdout
startsecs=5                   ; Wait 5 seconds before considering the process started
startretries=3                ; Retry up to 3 times if the process fails to start

[program:worker_data]
command=python3 worker_data.py
directory=/app                ; Specify the working directory
autostart=true
autorestart=true
stderr_logfile=/var/log/worker_data.err.log
stdout_logfile=/var/log/worker_data.out.log
redirect_stderr=true          ; Redirect stderr to stdout
startsecs=5                   ; Wait 5 seconds before considering the process started
startretries=3                ; Retry up to 3 times if the process fails to start

[program:worker_aggregator]
command=python3 aggregator_stats.py
directory=/app                ; Specify the working directory
autostart=true
autorestart=true
stderr_logfile=/var/log/aggregator_stats.err.log
stdout_logfile=/var/log/aggregator_stats.out.log
redirect_stderr=true          ; Redirect stderr to stdout
startsecs=5                   ; Wait 5 seconds before considering the process started
startretries=3                ; Retry up to 3 times if the process fails to start

[unix_http_server]
file=/var/run/supervisor.sock   ; Path to the socket file, moved from /tmp to /var/run
chmod=0777                      ; Allow all users to connect

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock  ; Use the same socket file as supervisor

